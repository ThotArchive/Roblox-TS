var e=function(e){return{_tag:"Left",left:e}},t=function(e){return{_tag:"Right",right:e}},n={_tag:"None"},r=function(e){return{_tag:"Some",value:e}},o=function(e){return function(t){return c(t)?n:r(e(t.value))}},i=function(e){return"Left"===e._tag?n:r(e.right)},u=function(e){return"Some"===e._tag},c=function(e){return"None"===e._tag},a=function(e){return function(t){return c(t)?e():t.value}},s=function(){function e(e,t){if(this.bufferIndex=0,e<1)throw new Error("EventPublishers must have size of at least 1!");this.maxEventQueueLength=e,this.eventQueue=new Array(this.maxEventQueueLength).fill(n),this.delegatePublisher=t,this.appendEvent=this.appendEvent.bind(this),this.publish=this.publish.bind(this)}return e.prototype.appendEvent=function(e){var t=this.bufferIndex%this.maxEventQueueLength,n=this.eventQueue[t];return this.eventQueue[t]=r(e),this.bufferIndex%=this.maxEventQueueLength,this.bufferIndex+=1,u(n)},e.prototype.publish=function(){this.delegatePublisher.publish(this.eventQueue.filter(u))},e}();function f(e,t,n,r){return new(n||(n=Promise))((function(o,i){function u(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,c)}a((r=r.apply(e,t||[])).next())}))}function l(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},u=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return u.next=c(0),u.throw=c(1),u.return=c(2),"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function c(c){return function(a){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;u&&(u=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,a])}}}function p(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var d="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},h=function(e){return e&&e.Math===Math&&e},v=h("object"==typeof globalThis&&globalThis)||h("object"==typeof window&&window)||h("object"==typeof self&&self)||h("object"==typeof d&&d)||h("object"==typeof d&&d)||function(){return this}()||Function("return this")(),b={},y=function(e){try{return!!e()}catch(e){return!0}},m=!y((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})),g=!y((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),w=g,S=Function.prototype.call,j=w?S.bind(S):function(){return S.apply(S,arguments)},E={},O={}.propertyIsEnumerable,x=Object.getOwnPropertyDescriptor,R=x&&!O.call({1:2},1);E.f=R?function(e){var t=x(this,e);return!!t&&t.enumerable}:O;var P,T,k=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},I=g,N=Function.prototype,A=N.call,C=I&&N.bind.bind(A,A),U=I?C:function(e){return function(){return A.apply(e,arguments)}},q=U,$=q({}.toString),z=q("".slice),D=y,_=function(e){return z($(e),8,-1)},L=Object,M=U("".split),F=D((function(){return!L("z").propertyIsEnumerable(0)}))?function(e){return"String"===_(e)?M(e,""):L(e)}:L,G=function(e){return null==e},B=G,H=TypeError,Q=function(e){if(B(e))throw new H("Can't call method on "+e);return e},W=F,V=Q,K=function(e){return W(V(e))},J="object"==typeof document&&document.all,X=void 0===J&&void 0!==J?function(e){return"function"==typeof e||e===J}:function(e){return"function"==typeof e},Y=X,Z=function(e){return"object"==typeof e?null!==e:Y(e)},ee=v,te=X,ne=function(e,t){return arguments.length<2?(n=ee[e],te(n)?n:void 0):ee[e]&&ee[e][t];var n},re=U({}.isPrototypeOf),oe=v.navigator,ie=oe&&oe.userAgent,ue=v,ce=ie?String(ie):"",ae=ue.process,se=ue.Deno,fe=ae&&ae.versions||se&&se.version,le=fe&&fe.v8;le&&(T=(P=le.split("."))[0]>0&&P[0]<4?1:+(P[0]+P[1])),!T&&ce&&(!(P=ce.match(/Edge\/(\d+)/))||P[1]>=74)&&(P=ce.match(/Chrome\/(\d+)/))&&(T=+P[1]);var pe=T,de=y,he=v.String,ve=!!Object.getOwnPropertySymbols&&!de((function(){var e=Symbol("symbol detection");return!he(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&pe&&pe<41})),be=ve&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ye=ne,me=X,ge=re,we=Object,Se=be?function(e){return"symbol"==typeof e}:function(e){var t=ye("Symbol");return me(t)&&ge(t.prototype,we(e))},je=String,Ee=X,Oe=function(e){try{return je(e)}catch(e){return"Object"}},xe=TypeError,Re=function(e){if(Ee(e))return e;throw new xe(Oe(e)+" is not a function")},Pe=Re,Te=G,ke=j,Ie=X,Ne=Z,Ae=TypeError,Ce={exports:{}},Ue=v,qe=Object.defineProperty,$e=function(e,t){try{qe(Ue,e,{value:t,configurable:!0,writable:!0})}catch(n){Ue[e]=t}return t},ze=v,De=$e,_e="__core-js_shared__",Le=Ce.exports=ze[_e]||De(_e,{});(Le.versions||(Le.versions=[])).push({version:"3.41.0",mode:"global",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.41.0/LICENSE",source:"https://github.com/zloirock/core-js"});var Me=Ce.exports,Fe=Me,Ge=function(e,t){return Fe[e]||(Fe[e]=t||{})},Be=Q,He=Object,Qe=function(e){return He(Be(e))},We=U({}.hasOwnProperty),Ve=Object.hasOwn||function(e,t){return We(Qe(e),t)},Ke=U,Je=0,Xe=Math.random(),Ye=Ke(1..toString),Ze=function(e){return"Symbol("+(void 0===e?"":e)+")_"+Ye(++Je+Xe,36)},et=Ge,tt=Ve,nt=Ze,rt=ve,ot=be,it=v.Symbol,ut=et("wks"),ct=ot?it.for||it:it&&it.withoutSetter||nt,at=j,st=Z,ft=Se,lt=function(e,t){var n=e[t];return Te(n)?void 0:Pe(n)},pt=function(e,t){var n,r;if("string"===t&&Ie(n=e.toString)&&!Ne(r=ke(n,e)))return r;if(Ie(n=e.valueOf)&&!Ne(r=ke(n,e)))return r;if("string"!==t&&Ie(n=e.toString)&&!Ne(r=ke(n,e)))return r;throw new Ae("Can't convert object to primitive value")},dt=TypeError,ht=function(e){return tt(ut,e)||(ut[e]=rt&&tt(it,e)?it[e]:ct("Symbol."+e)),ut[e]}("toPrimitive"),vt=function(e,t){if(!st(e)||ft(e))return e;var n,r=lt(e,ht);if(r){if(void 0===t&&(t="default"),n=at(r,e,t),!st(n)||ft(n))return n;throw new dt("Can't convert object to primitive value")}return void 0===t&&(t="number"),pt(e,t)},bt=Se,yt=function(e){var t=vt(e,"string");return bt(t)?t:t+""},mt=Z,gt=v.document,wt=mt(gt)&&mt(gt.createElement),St=function(e){return wt?gt.createElement(e):{}},jt=!m&&!y((function(){return 7!==Object.defineProperty(St("div"),"a",{get:function(){return 7}}).a})),Et=m,Ot=j,xt=E,Rt=k,Pt=K,Tt=yt,kt=Ve,It=jt,Nt=Object.getOwnPropertyDescriptor;b.f=Et?Nt:function(e,t){if(e=Pt(e),t=Tt(t),It)try{return Nt(e,t)}catch(e){}if(kt(e,t))return Rt(!Ot(xt.f,e,t),e[t])};var At={},Ct=m&&y((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Ut=Z,qt=String,$t=TypeError,zt=function(e){if(Ut(e))return e;throw new $t(qt(e)+" is not an object")},Dt=m,_t=jt,Lt=Ct,Mt=zt,Ft=yt,Gt=TypeError,Bt=Object.defineProperty,Ht=Object.getOwnPropertyDescriptor,Qt="enumerable",Wt="configurable",Vt="writable";At.f=Dt?Lt?function(e,t,n){if(Mt(e),t=Ft(t),Mt(n),"function"==typeof e&&"prototype"===t&&"value"in n&&Vt in n&&!n[Vt]){var r=Ht(e,t);r&&r[Vt]&&(e[t]=n.value,n={configurable:Wt in n?n[Wt]:r[Wt],enumerable:Qt in n?n[Qt]:r[Qt],writable:!1})}return Bt(e,t,n)}:Bt:function(e,t,n){if(Mt(e),t=Ft(t),Mt(n),_t)try{return Bt(e,t,n)}catch(e){}if("get"in n||"set"in n)throw new Gt("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var Kt=At,Jt=k,Xt=m?function(e,t,n){return Kt.f(e,t,Jt(1,n))}:function(e,t,n){return e[t]=n,e},Yt={exports:{}},Zt=m,en=Ve,tn=Function.prototype,nn=Zt&&Object.getOwnPropertyDescriptor,rn=en(tn,"name"),on={EXISTS:rn,PROPER:rn&&"something"===function(){}.name,CONFIGURABLE:rn&&(!Zt||Zt&&nn(tn,"name").configurable)},un=X,cn=Me,an=U(Function.toString);un(cn.inspectSource)||(cn.inspectSource=function(e){return an(e)});var sn,fn,ln,pn=cn.inspectSource,dn=X,hn=v.WeakMap,vn=dn(hn)&&/native code/.test(String(hn)),bn=Ze,yn=Ge("keys"),mn={},gn=vn,wn=v,Sn=Z,jn=Xt,En=Ve,On=Me,xn=function(e){return yn[e]||(yn[e]=bn(e))},Rn=mn,Pn="Object already initialized",Tn=wn.TypeError,kn=wn.WeakMap;if(gn||On.state){var In=On.state||(On.state=new kn);In.get=In.get,In.has=In.has,In.set=In.set,sn=function(e,t){if(In.has(e))throw new Tn(Pn);return t.facade=e,In.set(e,t),t},fn=function(e){return In.get(e)||{}},ln=function(e){return In.has(e)}}else{var Nn=xn("state");Rn[Nn]=!0,sn=function(e,t){if(En(e,Nn))throw new Tn(Pn);return t.facade=e,jn(e,Nn,t),t},fn=function(e){return En(e,Nn)?e[Nn]:{}},ln=function(e){return En(e,Nn)}}var An={set:sn,get:fn,has:ln,enforce:function(e){return ln(e)?fn(e):sn(e,{})},getterFor:function(e){return function(t){var n;if(!Sn(t)||(n=fn(t)).type!==e)throw new Tn("Incompatible receiver, "+e+" required");return n}}},Cn=U,Un=y,qn=X,$n=Ve,zn=m,Dn=on.CONFIGURABLE,_n=pn,Ln=An.enforce,Mn=An.get,Fn=String,Gn=Object.defineProperty,Bn=Cn("".slice),Hn=Cn("".replace),Qn=Cn([].join),Wn=zn&&!Un((function(){return 8!==Gn((function(){}),"length",{value:8}).length})),Vn=String(String).split("String"),Kn=Yt.exports=function(e,t,n){"Symbol("===Bn(Fn(t),0,7)&&(t="["+Hn(Fn(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!$n(e,"name")||Dn&&e.name!==t)&&(zn?Gn(e,"name",{value:t,configurable:!0}):e.name=t),Wn&&n&&$n(n,"arity")&&e.length!==n.arity&&Gn(e,"length",{value:n.arity});try{n&&$n(n,"constructor")&&n.constructor?zn&&Gn(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var r=Ln(e);return $n(r,"source")||(r.source=Qn(Vn,"string"==typeof t?t:"")),e};Function.prototype.toString=Kn((function(){return qn(this)&&Mn(this).source||_n(this)}),"toString");var Jn=Yt.exports,Xn=X,Yn=At,Zn=Jn,er=$e,tr={},nr=Math.ceil,rr=Math.floor,or=Math.trunc||function(e){var t=+e;return(t>0?rr:nr)(t)},ir=function(e){var t=+e;return t!=t||0===t?0:or(t)},ur=ir,cr=Math.max,ar=Math.min,sr=ir,fr=Math.min,lr=function(e){var t=sr(e);return t>0?fr(t,9007199254740991):0},pr=K,dr=function(e,t){var n=ur(e);return n<0?cr(n+t,0):ar(n,t)},hr=function(e){return lr(e.length)},vr=function(e){return function(t,n,r){var o=pr(t),i=hr(o);if(0===i)return!e&&-1;var u,c=dr(r,i);if(e&&n!=n){for(;i>c;)if((u=o[c++])!=u)return!0}else for(;i>c;c++)if((e||c in o)&&o[c]===n)return e||c||0;return!e&&-1}},br={includes:vr(!0),indexOf:vr(!1)},yr=Ve,mr=K,gr=br.indexOf,wr=mn,Sr=U([].push),jr=function(e,t){var n,r=mr(e),o=0,i=[];for(n in r)!yr(wr,n)&&yr(r,n)&&Sr(i,n);for(;t.length>o;)yr(r,n=t[o++])&&(~gr(i,n)||Sr(i,n));return i},Er=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"].concat("length","prototype");tr.f=Object.getOwnPropertyNames||function(e){return jr(e,Er)};var Or={};Or.f=Object.getOwnPropertySymbols;var xr=ne,Rr=tr,Pr=Or,Tr=zt,kr=U([].concat),Ir=xr("Reflect","ownKeys")||function(e){var t=Rr.f(Tr(e)),n=Pr.f;return n?kr(t,n(e)):t},Nr=Ve,Ar=Ir,Cr=b,Ur=At,qr=y,$r=X,zr=/#|\.prototype\./,Dr=function(e,t){var n=Lr[_r(e)];return n===Fr||n!==Mr&&($r(t)?qr(t):!!t)},_r=Dr.normalize=function(e){return String(e).replace(zr,".").toLowerCase()},Lr=Dr.data={},Mr=Dr.NATIVE="N",Fr=Dr.POLYFILL="P",Gr=Dr,Br=v,Hr=b.f,Qr=Xt,Wr=function(e,t,n,r){r||(r={});var o=r.enumerable,i=void 0!==r.name?r.name:t;if(Xn(n)&&Zn(n,i,r),r.global)o?e[t]=n:er(t,n);else{try{r.unsafe?e[t]&&(o=!0):delete e[t]}catch(e){}o?e[t]=n:Yn.f(e,t,{value:n,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return e},Vr=$e,Kr=function(e,t,n){for(var r=Ar(t),o=Ur.f,i=Cr.f,u=0;u<r.length;u++){var c=r[u];Nr(e,c)||n&&Nr(n,c)||o(e,c,i(t,c))}},Jr=Gr,Xr={},Yr=Re,Zr=TypeError,eo=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw new Zr("Bad Promise constructor");t=e,n=r})),this.resolve=Yr(t),this.reject=Yr(n)};Xr.f=function(e){return new eo(e)};var to=function(e,t){var n,r,o,i,u,c=e.target,a=e.global,s=e.stat;if(n=a?Br:s?Br[c]||Vr(c,{}):Br[c]&&Br[c].prototype)for(r in t){if(i=t[r],o=e.dontCallGetSet?(u=Hr(n,r))&&u.value:n[r],!Jr(a?r:c+(s?".":"#")+r,e.forced)&&void 0!==o){if(typeof i==typeof o)continue;Kr(i,o)}(e.sham||o&&o.sham)&&Qr(i,"sham",!0),Wr(n,r,i,e)}},no=Xr;to({target:"Promise",stat:!0},{withResolvers:function(){var e=no.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var ro=e,oo=t,io=function(e){return"Left"===e._tag},uo=function(e,t){try{return oo(e())}catch(e){return ro(t(e))}},co={};!function(e){var t=d&&d.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(e,"__esModule",{value:!0}),e.dual=e.getEndomorphismMonoid=e.SK=e.hole=e.constVoid=e.constUndefined=e.constNull=e.constFalse=e.constTrue=e.unsafeCoerce=e.apply=e.getRing=e.getSemiring=e.getMonoid=e.getSemigroup=e.getBooleanAlgebra=void 0,e.identity=n,e.constant=r,e.flip=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.length>1?e(t[1],t[0]):function(n){return e(n)(t[0])}}},e.flow=o,e.tuple=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e},e.increment=function(e){return e+1},e.decrement=function(e){return e-1},e.absurd=i,e.tupled=function(e){return function(t){return e.apply(void 0,t)}},e.untupled=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e(t)}},e.pipe=function(e,t,n,r,o,i,u,c,a){switch(arguments.length){case 1:return e;case 2:return t(e);case 3:return n(t(e));case 4:return r(n(t(e)));case 5:return o(r(n(t(e))));case 6:return i(o(r(n(t(e)))));case 7:return u(i(o(r(n(t(e))))));case 8:return c(u(i(o(r(n(t(e)))))));case 9:return a(c(u(i(o(r(n(t(e))))))));default:for(var s=arguments[0],f=1;f<arguments.length;f++)s=arguments[f](s);return s}},e.not=function(e){return function(t){return!e(t)}};e.getBooleanAlgebra=function(e){return function(){return{meet:function(t,n){return function(r){return e.meet(t(r),n(r))}},join:function(t,n){return function(r){return e.join(t(r),n(r))}},zero:function(){return e.zero},one:function(){return e.one},implies:function(t,n){return function(r){return e.implies(t(r),n(r))}},not:function(t){return function(n){return e.not(t(n))}}}}};e.getSemigroup=function(e){return function(){return{concat:function(t,n){return function(r){return e.concat(t(r),n(r))}}}}};e.getMonoid=function(t){var n=(0,e.getSemigroup)(t);return function(){return{concat:n().concat,empty:function(){return t.empty}}}};e.getSemiring=function(e){return{add:function(t,n){return function(r){return e.add(t(r),n(r))}},zero:function(){return e.zero},mul:function(t,n){return function(r){return e.mul(t(r),n(r))}},one:function(){return e.one}}};e.getRing=function(t){var n=(0,e.getSemiring)(t);return{add:n.add,mul:n.mul,one:n.one,zero:n.zero,sub:function(e,n){return function(r){return t.sub(e(r),n(r))}}}};function n(e){return e}function r(e){return function(){return e}}function o(e,t,n,r,o,i,u,c,a){switch(arguments.length){case 1:return e;case 2:return function(){return t(e.apply(this,arguments))};case 3:return function(){return n(t(e.apply(this,arguments)))};case 4:return function(){return r(n(t(e.apply(this,arguments))))};case 5:return function(){return o(r(n(t(e.apply(this,arguments)))))};case 6:return function(){return i(o(r(n(t(e.apply(this,arguments))))))};case 7:return function(){return u(i(o(r(n(t(e.apply(this,arguments)))))))};case 8:return function(){return c(u(i(o(r(n(t(e.apply(this,arguments))))))))};case 9:return function(){return a(c(u(i(o(r(n(t(e.apply(this,arguments)))))))))}}}function i(e){throw new Error("Called `absurd` function which should be uncallable")}e.apply=function(e){return function(t){return t(e)}},e.unsafeCoerce=n,e.constTrue=r(!0),e.constFalse=r(!1),e.constNull=r(null),e.constUndefined=r(void 0),e.constVoid=e.constUndefined,e.hole=i;e.SK=function(e,t){return t};e.getEndomorphismMonoid=function(){return{concat:function(e,t){return o(e,t)},empty:n}};e.dual=function(e,n){var r="number"==typeof e?function(t){return t.length>=e}:e;return function(){var e=Array.from(arguments);return r(arguments)?n.apply(this,e):function(r){return n.apply(void 0,t([r],e,!1))}}}}(co);var ao=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function u(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,c)}a((r=r.apply(e,t||[])).next())}))},so=function(e,t){var n,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(a){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(u=0)),u;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return u.label++,{value:c[1],done:!1};case 5:u.label++,r=c[1],c=[0];continue;case 7:c=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){u=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){u.label=c[1];break}if(6===c[0]&&u.label<o[1]){u.label=o[1],o=c;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(c);break}o[2]&&u.ops.pop(),u.trys.pop();continue}c=t.call(e,u)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,a])}}};const fo=/\{[^{}]+\}/g;function lo(e){let{baseUrl:t="",Request:n=globalThis.Request,fetch:r=globalThis.fetch,querySerializer:o,bodySerializer:i,headers:u,requestInitExt:c,...a}={...e};c="object"==typeof process&&Number.parseInt(process?.versions?.node?.substring(0,2))>=18&&process.versions.undici?c:void 0,t=go(t);const s=[];async function f(e,f){const{baseUrl:l,fetch:p=r,Request:d=n,headers:h,params:v={},parseAs:b="json",querySerializer:y,bodySerializer:m=i??yo,body:g,...w}=f||{};l&&(t=go(l));let S="function"==typeof o?o:bo(o);y&&(S="function"==typeof y?y:bo({..."object"==typeof o?o:{},...y}));const j=void 0===g?void 0:m(g),E=void 0===j||j instanceof FormData?{}:{"Content-Type":"application/json"},O={redirect:"follow",...a,...w,body:j,headers:mo(E,u,h,v.header)};let x,R,P,T=new n(function(e,t){let n=`${t.baseUrl}${e}`;t.params?.path&&(n=function(e,t){let n=e;for(const r of e.match(fo)??[]){let e=r.substring(1,r.length-1),o=!1,i="simple";if(e.endsWith("*")&&(o=!0,e=e.substring(0,e.length-1)),e.startsWith(".")?(i="label",e=e.substring(1)):e.startsWith(";")&&(i="matrix",e=e.substring(1)),!t||void 0===t[e]||null===t[e])continue;const u=t[e];Array.isArray(u)?n=n.replace(r,vo(e,u,{style:i,explode:o})):n="object"!=typeof u?"matrix"!==i?n.replace(r,"label"===i?`.${encodeURIComponent(u)}`:encodeURIComponent(u)):n.replace(r,`;${po(e,u)}`):n.replace(r,ho(e,u,{style:i,explode:o}))}return n}(n,t.params.path));let r=t.querySerializer(t.params.query??{});r.startsWith("?")&&(r=r.substring(1));r&&(n+=`?${r}`);return n}(e,{baseUrl:t,params:v,querySerializer:S}),O);for(const e in w)e in T||(T[e]=w[e]);if(s.length){x=Math.random().toString(36).slice(2,11),R=Object.freeze({baseUrl:t,fetch:p,parseAs:b,querySerializer:S,bodySerializer:m});for(const t of s)if(t&&"object"==typeof t&&"function"==typeof t.onRequest){const r=await t.onRequest({request:T,schemaPath:e,params:v,options:R,id:x});if(r){if(!(r instanceof n)){if(r instanceof Response){P=r;break}throw new Error("onRequest: must return new Request() or Response() when modifying the request")}T=r}}}if(!P){try{P=await p(T,c)}catch(k){let t=k;if(s.length)for(let n=s.length-1;n>=0;n--){const r=s[n];if(r&&"object"==typeof r&&"function"==typeof r.onError){const n=await r.onError({request:T,error:t,schemaPath:e,params:v,options:R,id:x});if(n){if(n instanceof Response){t=void 0,P=n;break}if(n instanceof Error){t=n;continue}throw new Error("onError: must return new Response() or instance of Error")}}}if(t)throw t}if(s.length)for(let t=s.length-1;t>=0;t--){const n=s[t];if(n&&"object"==typeof n&&"function"==typeof n.onResponse){const t=await n.onResponse({request:T,response:P,schemaPath:e,params:v,options:R,id:x});if(t){if(!(t instanceof Response))throw new Error("onResponse: must return new Response() when modifying the response");P=t}}}}if(204===P.status||"0"===P.headers.get("Content-Length"))return P.ok?{data:void 0,response:P}:{error:void 0,response:P};if(P.ok)return"stream"===b?{data:P.body,response:P}:{data:await P[b](),response:P};let k=await P.text();try{k=JSON.parse(k)}catch{}return{error:k,response:P}}return{request:(e,t,n)=>f(t,{...n,method:e.toUpperCase()}),GET:(e,t)=>f(e,{...t,method:"GET"}),PUT:(e,t)=>f(e,{...t,method:"PUT"}),POST:(e,t)=>f(e,{...t,method:"POST"}),DELETE:(e,t)=>f(e,{...t,method:"DELETE"}),OPTIONS:(e,t)=>f(e,{...t,method:"OPTIONS"}),HEAD:(e,t)=>f(e,{...t,method:"HEAD"}),PATCH:(e,t)=>f(e,{...t,method:"PATCH"}),TRACE:(e,t)=>f(e,{...t,method:"TRACE"}),use(...e){for(const t of e)if(t){if("object"!=typeof t||!("onRequest"in t||"onResponse"in t||"onError"in t))throw new Error("Middleware must be an object with one of `onRequest()`, `onResponse() or `onError()`");s.push(t)}},eject(...e){for(const t of e){const e=s.indexOf(t);-1!==e&&s.splice(e,1)}}}}function po(e,t,n){if(null==t)return"";if("object"==typeof t)throw new Error("Deeply-nested arrays/objects aren’t supported. Provide your own `querySerializer()` to handle these.");return`${e}=${!0===n?.allowReserved?t:encodeURIComponent(t)}`}function ho(e,t,n){if(!t||"object"!=typeof t)return"";const r=[],o={simple:",",label:".",matrix:";"}[n.style]||"&";if("deepObject"!==n.style&&!1===n.explode){for(const e in t)r.push(e,!0===n.allowReserved?t[e]:encodeURIComponent(t[e]));const o=r.join(",");switch(n.style){case"form":return`${e}=${o}`;case"label":return`.${o}`;case"matrix":return`;${e}=${o}`;default:return o}}for(const o in t){const i="deepObject"===n.style?`${e}[${o}]`:o;r.push(po(i,t[o],n))}const i=r.join(o);return"label"===n.style||"matrix"===n.style?`${o}${i}`:i}function vo(e,t,n){if(!Array.isArray(t))return"";if(!1===n.explode){const r={form:",",spaceDelimited:"%20",pipeDelimited:"|"}[n.style]||",",o=(!0===n.allowReserved?t:t.map((e=>encodeURIComponent(e)))).join(r);switch(n.style){case"simple":return o;case"label":return`.${o}`;case"matrix":return`;${e}=${o}`;default:return`${e}=${o}`}}const r={simple:",",label:".",matrix:";"}[n.style]||"&",o=[];for(const r of t)"simple"===n.style||"label"===n.style?o.push(!0===n.allowReserved?r:encodeURIComponent(r)):o.push(po(e,r,n));return"label"===n.style||"matrix"===n.style?`${r}${o.join(r)}`:o.join(r)}function bo(e){return function(t){const n=[];if(t&&"object"==typeof t)for(const r in t){const o=t[r];if(null!=o)if(Array.isArray(o)){if(0===o.length)continue;n.push(vo(r,o,{style:"form",explode:!0,...e?.array,allowReserved:e?.allowReserved||!1}))}else"object"!=typeof o?n.push(po(r,o,e)):n.push(ho(r,o,{style:"deepObject",explode:!0,...e?.object,allowReserved:e?.allowReserved||!1}))}return n.join("&")}}function yo(e){return e instanceof FormData?e:JSON.stringify(e)}function mo(...e){const t=new Headers;for(const n of e){if(!n||"object"!=typeof n)continue;const e=n instanceof Headers?n.entries():Object.entries(n);for(const[n,r]of e)if(null===r)t.delete(n);else if(Array.isArray(r))for(const e of r)t.append(n,e);else void 0!==r&&t.set(n,r)}return t}function go(e){return e.endsWith("/")?e.substring(0,e.length-1):e}var wo,So,jo=(null===(So=null===(wo=window.Roblox)||void 0===wo?void 0:wo.Cookies)||void 0===So?void 0:So.getBrowserTrackerId)||function(){return"unknown"},Eo=function(e,t){var n=lo({baseUrl:e()});return c(t)||n.use.apply(n,t.value),n},Oo=function(){var e,t,n,r=null!==(n=null===(t=null===(e=window.Roblox)||void 0===e?void 0:e.EnvironmentUrls)||void 0===t?void 0:t.apiGatewayUrl)&&void 0!==n?n:"NOT_FOUND";return"".concat(r,"/account-security-service")},xo=Oo(),Ro=Eo((function(){return xo}),n),Po=function(n,r,o){for(var i=[],u=3;u<arguments.length;u++)i[u-3]=arguments[u];return f(void 0,p([n,r,o],i,!0),void 0,(function(n,r,o,i){return void 0===i&&(i=Ro),l(this,(function(u){switch(u.label){case 0:return[4,(c=function(){return f(void 0,void 0,void 0,(function(){return l(this,(function(e){return[2,i.POST("/v1/metrics/record",{baseUrl:Oo(),body:{identifier:o||jo(),name:n,labelValues:r,value:1}})]}))}))},a=function(){},function(){return ao(void 0,void 0,void 0,(function(){var n;return so(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,c().then(t)];case 1:return[2,r.sent()];case 2:return n=r.sent(),[2,e(a(n))];case 3:return[2]}}))}))})()];case 1:return u.sent(),[2]}var c,a}))}))},To="rbxIndexedDBSmokeTest",ko=function(e,t,n){var r,o=Promise.withResolvers(),i=o.promise,u=o.resolve,c=o.reject;switch(t){default:if(e.objectStoreNames.contains(n)){Po(To,{success:"true",arm:"transaction-upgrade-objstore-exists"}),u(null);break}co.pipe(uo((function(){return e.createObjectStore(n)}),(function(e){var t,n="unknownerr-create-objstore";return Po(To,{success:"false",arm:"transaction-upgrade-objstore-creation",error:null!==(t=e instanceof Error&&(null==e?void 0:e.message)||n)&&void 0!==t?t:n}),c(new Error("Could not create object store.")),ro(e)})),(r=function(e){return Po(To,{success:"true",arm:"transaction-upgrade-objstore-creation"}),u(e)},function(e){return io(e)?e:oo(r(e.right))}))}return i},Io=function(e){var t=e.request,i=e.objectStoreName,c=e.upgradesHandler,a=Promise.withResolvers(),s=a.promise,p=a.resolve,d=a.reject;return t.onsuccess=function(e){var t=e.target.result;Po(To,{success:"true",arm:"connection"}),p(t)},t.onerror=function(e){var t,n=e.target.error;Po(To,{success:"false",arm:"connection",error:null!==(t=null==n?void 0:n.message)&&void 0!==t?t:"unknown-onerror"}),d(n)},t.onupgradeneeded=function(e){return f(void 0,void 0,void 0,(function(){var t,a,f,d;return l(this,(function(l){switch(l.label){case 0:return t=e.target,a=t.result,[4,c(a,e.oldVersion,i)];case 1:return f=l.sent(),d=co.pipe(null==(h=f)?n:r(h),o((function(e){return e.transaction.oncomplete=function(){Po(To,{success:"true",arm:"connection-initial-transaction"}),p(a)},s}))),u(d)?[2]:(Po(To,{success:"true",arm:"connection-initial-transaction-early"}),p(a),[2])}var h}))}))},t.onblocked=function(e){var t=e.target.result;Po(To,{success:"true",arm:"connection-blocked"}),t.close()},s},No=function(e){var t=e.databaseName,n=e.objectStoreName,r=e.version;return co.pipe(uo((function(){return Po(To,{success:"true",arm:"open-connection"}),Io({request:indexedDB.open(t,r),objectStoreName:n,upgradesHandler:ko})}),(function(e){var t,n="unknownerr-open-connection";return Po(To,{success:"false",arm:"open-connection",error:null!==(t=e instanceof Error&&(null==e?void 0:e.message)||n)&&void 0!==t?t:n}),e})),i)},Ao=function(e){var t=e.database,o=e.objectStoreName,i=e.key;if(!t.objectStoreNames.contains(o))return n;var u=Promise.withResolvers(),c=u.promise,a=u.resolve,s=t.transaction(o,"readonly");return s.oncomplete=function(){Po(To,{success:"true",arm:"transaction-get-complete"})},s.objectStore(o).get(i).onsuccess=function(e){var t=e.target.result;Po(To,{success:"true",arm:"transaction-get"}),a(t)},r(c)},Co=function(e){var t=e.database,o=e.objectStoreName,i=e.key,u=e.value;if(!t.objectStoreNames.contains(o))return n;var c=Promise.withResolvers(),a=c.promise,s=c.resolve,f=t.transaction(o,"readwrite");return f.oncomplete=function(){Po(To,{success:"true",arm:"transaction-put-complete"})},f.objectStore(o).put(u,i).onsuccess=function(e){var t=e.target.result;Po(To,{success:"true",arm:"transaction-put"}),s(t)},r(a)},Uo=function(){var e,t,n,r=null!==(n=null===(t=null===(e=window.Roblox)||void 0===e?void 0:e.EnvironmentUrls)||void 0===t?void 0:t.apiGatewayUrl)&&void 0!==n?n:"NOT_FOUND";return"".concat(r,"/rotating-client-service")}(),qo=Eo((function(){return Uo}),n),$o=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return f(void 0,p([],e,!0),void 0,(function(e){var t;return void 0===e&&(e=qo),l(this,(function(n){switch(n.label){case 0:return[4,e.GET("/v1/metadata")];case 1:return(t=n.sent()).error?[2,{enableIndexedDbTelemetry:!1}]:[2,t.data]}}))}))},zo="rbxInstrumentationStore",Do="rbxTimestamp",_o=function(){return f(void 0,void 0,void 0,(function(){var e,t,n,r,i,u;return l(this,(function(s){switch(s.label){case 0:return[4,$o()];case 1:return s.sent().enableIndexedDbTelemetry?(e=No({databaseName:"rbxInstrumentationDb",objectStoreName:zo,version:1}),c(e)?(Po(To,{success:"false",arm:"connection-consumer"}),[2]):[4,e.value]):[2];case 2:return t=s.sent(),n=Ao({database:t,objectStoreName:zo,key:Do}),c(n)?(Po(To,{success:"false",arm:"get-consumer"}),[2]):[4,n.value];case 3:return void 0!==(r=s.sent())?(Po(To,{success:"true",arm:"get-consumer",timestamp:r.toString()}),[2]):(i=(new Date).getTime(),u=Co({database:t,objectStoreName:zo,key:Do,value:i}),co.pipe(u,o((function(){return{success:"true",arm:"put-consumer",timestamp:i.toString()}})),a((function(){return{success:"false",arm:"put-consumer",timestamp:i.toString()}})),(function(e){return Po(To,e)})),[2])}}))}))};export{s as BoundedEventPublisher,Io as getPromisifiedConnection,Ao as getWithDefaultHandlers,_o as instrumentTimestamp,Co as putWithDefaultHandlers,No as tryGetIndexedDBConnectionWithDefaults};
